<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manipulation of Maps • ggmapr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Manipulation of Maps">
<meta property="og:description" content="Tools for working with maps: scale and shift regions on maps. 
    Sample random uniform locations in maps.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">ggmapr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    

<div id="installation" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h1></div>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="st">"heike/ggmapr"</span>)</a></code></pre></div>
</div>
<div id="basic-usage" class="section level1">
<h1 class="hasAnchor">
<a href="#basic-usage" class="anchor"></a>Basic Usage</h1>
<p>This R package is helping with working with maps by making insets, pull-outs or zooms:</p>
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>This map is saved as object <code>division</code> in the package.</p>
<p>Map of <strong>all</strong> US states and state equivalents as defined by the 2016 Tiger shapefiles provided by the US Census Bureau:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">data</span>(states)</a>
<a class="sourceLine" id="cb2-2" title="2">states <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">group =</span> group)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="st">  </span>ggthemes<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggthemes/topics/theme_map">theme_map</a></span>()</a></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>The functions <code>scale</code> and <code>shift</code> allow us to scale and shift parts of the map:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">states <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="st">  </span><span class="kw"><a href="reference/shift.html">shift</a></span>(NAME <span class="op">==</span><span class="st"> "Hawaii"</span>, <span class="dt">shift_by =</span> <span class="kw">c</span>(<span class="fl">52.5</span>, <span class="fl">5.5</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="st">  </span><span class="kw"><a href="reference/scale.html">scale</a></span>(NAME <span class="op">==</span><span class="st"> "Alaska"</span>, <span class="dt">scale=</span><span class="fl">0.3</span>, <span class="dt">set_to=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">117</span>, <span class="dv">27</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="st">  </span><span class="kw">filter</span>(lat <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(long, lat)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">group=</span>group)) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="st">  </span>ggthemes<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggthemes/topics/theme_map">theme_map</a></span>() </a></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>This map is available as data object <code>inset</code>.</p>
<p>Looking for counties as well? The objects <code>counties</code> and <code>counties_inset</code> are available in the data objects.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">counties_inset <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">group =</span> group), <span class="dt">size=</span><span class="fl">0.25</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">group =</span> group), <span class="dt">data =</span> inset) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="st">  </span>ggthemes<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggthemes/topics/theme_map">theme_map</a></span>() </a></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div id="scale-one-or-many" class="section level2">
<h2 class="hasAnchor">
<a href="#scale-one-or-many" class="anchor"></a>Scale one or many?</h2>
<p>Scaling the whole object is not very impressive looking, because the only thing that visibly changes is the axis labelling. Using <code>nest</code> and <code>unnest</code> we can get the scaling at a grouping level:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">counties <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(STATE <span class="op">==</span><span class="st"> "Iowa"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/nest.html">nest</a></span>(<span class="op">-</span>group) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="st">  </span><span class="kw">mutate</span>( <span class="dt">data =</span> data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="st">  </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="dt">.f =</span> <span class="cf">function</span>(x) <span class="kw"><a href="reference/scale.html">scale</a></span>(x, <span class="dt">scale=</span><span class="fl">0.8</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span>(data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_polygon</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Iowa counties at 80% size"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="st">  </span>ggthemes<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggthemes/topics/theme_map">theme_map</a></span>()</a></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" width="384"></p>
</div>
</div>
<div id="sampling-from-a-uniform-distribution" class="section level1">
<h1 class="hasAnchor">
<a href="#sampling-from-a-uniform-distribution" class="anchor"></a>Sampling from a uniform distribution</h1>
<p>Below are maps of the US overlaid by about 3200 points each. The points are placed uniformly within the geographic region. The number of points in each region is based on different strategies, but in all three maps each dot represents approximately 100k people. From left to right we have: (left) a sample of locations selected uniformly across the US, (middle) each state contains a set of 63 uniformly selected locations, (right) the number of points within each state is proportional to the state’s population.</p>
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" width="1152"></p>
<p>The function underlying the map based random sampling is <code>map_unif</code>. This function takes a map (or a subset of a map) and a number <code>n</code> and produces a dataset of <code>n</code> uniformly distributed random geo-locations within the area specified by the map. An alternative is implemented as <code>ggplot2</code> <span class="citation">(Wickham 2016)</span> statistic <code>stat_polygon_jitter</code>.</p>
</div>
<div id="thanksgiving-traditions" class="section level1">
<h1 class="hasAnchor">
<a href="#thanksgiving-traditions" class="anchor"></a>Thanksgiving traditions</h1>
<p>In 2015 FiveThirtyEight commissioned a survey asking people across the US a number of Thanksgiving related questions, such as side dishes, flavor of the pie, desserts and after dinner activities. They reported on the main difference in an <a href="http://fivethirtyeight.com/features/heres-what-your-part-of-america-eats-on-thanksgiving/">article published on Nov 20 2015</a>.</p>
<p>The dataset with responses of more than 1000 participants is available from FiveThirtEight’s <a href="https://github.com/fivethirtyeight/data/blob/master/thanksgiving-2015/thanksgiving-2015-poll-data.csv">data git hub repository</a>.</p>
<p>The main finding was shown in a choropleth chart highlighting the <strong>disproportionally most common side dish</strong> in each region.</p>
<p>The FiveThirtyEight chart is fun, but it doesn’t show the whole picture. What else can we find out from the data about Thanksgiving traditions?</p>
<p>Looking at how participants said to prepare their turkeys we see that the country is mostly divided between Roasting and Baking the turkey, but some proportion of participants said that their turkey was being fried (orange). When we look closer, we see that there is a geographical component to where turkeys are getting fried. <img src="index_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>For the side dishes, FiveThirtyEight styled a chart showing the <strong><em>disproportionally most common</em></strong> side dish. We have adapted the underlying model to deal with the <strong><em>disproportionally most common</em></strong> way of preparing the main dish. This gives a nice and simple map like this:</p>
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>We see that in the South and South East turkey’s are being fried disproportionally most often, whereas everywhere else it is a toss-up between roasting and baking the bird. But is that the whole picture … and what does disproprotionally most common actually mean?</p>
<p>Let’s go back to the raw data and put those on the map:</p>
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" width="1152"></p>
<p>We get a similar picture, if not quite as simple as the previous map - but data is rarely that simple! We still see the toss-up between baking and roasting. And it looks like the bakers of turkey are in the lead in the North East and the Mountain division. What we also see is the geographical connection of the fried turkeys: the South and South East sees more of them, but there are some friers all along the East Coast, that we didn’t see before.</p>
<p>Going back to the (loglinear) model of the ways turkeys are cooked by division, we can visualize the residuals using randomly picked locations in each of the divisions.</p>
<p><img src="index_files/figure-html/unnamed-chunk-14-1.png" width="384"></p>
<p><img src="index_files/figure-html/unnamed-chunk-15-1.png" width="1152"></p>
<p>What we see now, is the geographical pattern from before: fried turkeys are (disproportionally) most common in the South East, and we see the split between baked and roasted turkey across the country - with roasted turkey in particular most popular in New England. What we find additionally, though, is that besides fried turkey in the South East, we also see a liking of baked turkey that was not apparent before.</p>
<div id="some-discussion" class="section level2">
<h2 class="hasAnchor">
<a href="#some-discussion" class="anchor"></a>Some discussion</h2>
<div class="figure">
<img src="inst/images/indiana-schools.png" alt="Excerpt from plate #59 of the Statistical Atlas of 1883 showing density maps of the number of schools in counties of Indiana in 1853 (left) and 1880 (right)"><p class="caption">Excerpt from plate #59 of the Statistical Atlas of 1883 showing density maps of the number of schools in counties of Indiana in 1853 (left) and 1880 (right)</p>
</div>
<p>Density maps are not new - some of the first examples (see Figure ) appear in the Statistical Atlas accompanying the tenth US census of 1880 <span class="citation">(Hewes and Gannett 1883)</span> to show the number and, in particular, the increase in number of schools in counties in Indiana (see Figure ). The functions <code>dotsInPolys</code> of the <code>maptools</code> package <span class="citation">(Bivand and Lewin-Koh 2017)</span> and <code>point.in.polygon</code> of the <code>sp</code> package <span class="citation">(Pebesma and Bivand 2005, @sp2)</span>. <span class="citation">Waller and Gotway (2004)</span> (p.82) warn from using density maps for public health statistics. However, the only point the authors raise is that readers might be misled into believing that the (random) locations are geographically accurate occurrences of events.</p>
<p>XXX Interesting discussion at <a href="http://axismaps.github.io/thematic-cartography/articles/dot_density.html" class="uri">http://axismaps.github.io/thematic-cartography/articles/dot_density.html</a></p>
<p>XXX Just for fun <a href="https://xkcd.com/1845/" class="uri">https://xkcd.com/1845/</a></p>
</div>
</div>
<div id="getting-it-to-work" class="section level1">
<h1 class="hasAnchor">
<a href="#getting-it-to-work" class="anchor"></a>Getting it to work</h1>
<pre><code>if (!require(devtools)) {
    install.packages("devtools")
}
devtools::install_github("heike/ggmapr")</code></pre>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-maptools">
<p>Bivand, Roger, and Nicholas Lewin-Koh. 2017. <em>maptools: Tools for Reading and Handling Spatial Objects</em>. <a href="https://CRAN.R-project.org/package=maptools">https://CRAN.R-project.org/package=maptools</a>.</p>
</div>
<div id="ref-sp2">
<p>Bivand, Roger S., Edzer Pebesma, and Virgilio Gomez-Rubio. 2013. <em>Applied spatial data analysis with R</em>. 2nd ed. New York, NY: Springer. <a href="http://www.asdar-book.org/">http://www.asdar-book.org/</a>.</p>
</div>
<div id="ref-atlas">
<p>Hewes, Fletcher Willis, and Henry Gannett. 1883. “Scribner’s Statistical Atlas of the United States, Showing by Graphic Methods Their Present Condition and Their Political, Social and Industrial Development.” New York: digitized version provided through Library of Congress, <a href="https://www.loc.gov/item/a40001834/">https://www.loc.gov/item/a40001834/</a>; Charles Scribner’s Sons.</p>
</div>
<div id="ref-sp1">
<p>Pebesma, Edzer, and Roger S. Bivand. 2005. “Classes and methods for spatial data in R.” <em>R News</em> 5 (2). <a href="https://cran.r-project.org/doc/Rnews/">https://cran.r-project.org/doc/Rnews/</a>.</p>
</div>
<div id="ref-waller">
<p>Waller, Lance A., and Carol A. Gotway. 2004. <em>Applied Spatial Statistics for Public Health Data</em>. Wiley Series in Probability and Statistics. Hoboken, US: Wiley-Interscience.</p>
</div>
<div id="ref-ggplot2">
<p>Wickham, Hadley. 2016. <em>Ggplot2: Elegant Graphics for Data Analysis</em>. 2nd ed. Springer-Verlag New York. <a href="http://ggplot2.org">http://ggplot2.org</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Report a bug at <br><a href="NA">NA</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Heike Hofmann <br><small class="roles"> Author </small>  </li>
</ul>
</div>

      <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/heike/mapr"><img src="https://travis-ci.org/heike/mapr.svg?branch=master" alt="Travis-CI Build Status"></a></li>
</ul>
</div>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by Heike Hofmann.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
